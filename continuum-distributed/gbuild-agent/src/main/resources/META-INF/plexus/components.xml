<component-set>
  <components>

    <component>
      <role>org.apache.geronimo.gbuild.agent.ClientManager</role>
      <implementation>org.apache.geronimo.gbuild.agent.ClientManager</implementation>
      <configuration>
        <broker-url>tcp://localhost:61616</broker-url>
        <ping-interval>300000</ping-interval>
        <reconnect-attempts>10</reconnect-attempts>
        <reconnect-delay>600000</reconnect-delay>
      </configuration>
    </component>

    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildAgent</role>
      <role-hint>build-executor</role-hint>
      <implementation>org.apache.geronimo.gbuild.agent.ContinuumBuildAgent</implementation>
      <requirements>
        <requirement>
          <role>org.apache.geronimo.gbuild.agent.ClientManager</role>
        </requirement>
        <requirement>
          <role>org.apache.geronimo.gbuild.agent.BuildAgentExtentionManager</role>
        </requirement>
        <requirement>
          <role>org.apache.maven.continuum.buildcontroller.BuildController</role>
        </requirement>
        <requirement>
          <role>org.apache.maven.continuum.configuration.ConfigurationService</role>
        </requirement>
      </requirements>
      <configuration>
        <contributor>Unknown</contributor>
        <admin-address>scm@geronimo.apache.org</admin-address>
        <build-task-queue>BUILD.TASKS</build-task-queue>
        <build-results-topic>BUILD.RESULTS</build-results-topic>
        <working-directory>agent/work</working-directory>
        <build-output-directory>agent/output</build-output-directory>
      </configuration>
    </component>

    <component>
      <role>org.codehaus.plexus.action.Action</role>
      <role-hint>execute-builder</role-hint>
      <implementation>org.apache.geronimo.gbuild.agent.ExecuteDistributedBuilderContinuumAction</implementation>
      <requirements>
        <requirement>
          <role>org.apache.maven.continuum.configuration.ConfigurationService</role>
        </requirement>
        <requirement>
          <role>org.apache.maven.continuum.execution.manager.BuildExecutorManager</role>
        </requirement>
        <requirement>
          <role>org.apache.maven.continuum.notification.ContinuumNotificationDispatcher</role>
        </requirement>
        <requirement>
          <role>org.apache.maven.continuum.store.ContinuumStore</role>
        </requirement>
      </requirements>
    </component>

    <component>
      <role>org.apache.maven.continuum.store.ContinuumStore</role>
      <role-hint>agent-store</role-hint>
      <implementation>org.apache.geronimo.gbuild.agent.ThreadContextContinuumStore</implementation>
    </component>

    <component>
      <role>org.apache.maven.continuum.notification.ContinuumNotificationDispatcher</role>
      <!--<role-hint>agent-notifier</role-hint>-->
      <implementation>org.apache.geronimo.gbuild.agent.MockContinuumNotificationDispatcher</implementation>
    </component>

    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildAgentExtentionManager</role>
      <implementation>org.apache.geronimo.gbuild.agent.DefaultBuildAgentExtensionManager</implementation>
      <requirements>
        <requirement>
          <role>org.apache.geronimo.gbuild.agent.BuildAgentExtension</role>
          <field-name>extentions</field-name>
        </requirement>
      </requirements>
    </component>

    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildAgentExtension</role>
      <role-hint>file-include</role-hint>
      <implementation>org.apache.geronimo.gbuild.agent.FileIncludeExtension</implementation>
      <requirements>
        <requirement>
          <role>org.apache.maven.continuum.configuration.ConfigurationService</role>
        </requirement>
      </requirements>
      <configuration>
        <pattern>^include</pattern>
      </configuration>
    </component>

    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildAgentExtension</role>
      <role-hint>general-headers</role-hint>
      <implementation>org.apache.geronimo.gbuild.agent.HeaderIncludeExtension</implementation>
      <configuration>
        <pattern>^(project|build|header).*</pattern>
      </configuration>
    </component>


    <!--
    | Build Producer
    -->
    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildAgent</role>
      <role-hint>build-producer</role-hint>
      <implementation>org.apache.geronimo.gbuild.agent.PropertiesBuildTaskProducer</implementation>
      <requirements>
        <requirement>
          <role>org.apache.geronimo.gbuild.agent.ClientManager</role>
        </requirement>
      </requirements>
      <configuration>
        <build-task-queue>BUILD.TASKS</build-task-queue>
        <include-prefix>include.</include-prefix>
        <header-prefix>header.</header-prefix>
        <watch-directory>tasks</watch-directory>
        <poll-interval>10000</poll-interval>
      </configuration>
    </component>


    <!--
    | Build Producer
    -->
    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildQueueReloader</role>
      <role-hint>build-producer</role-hint>
      <implementation>org.apache.geronimo.gbuild.agent.BuildQueueReloader</implementation>
      <requirements>
        <requirement>
          <role>org.apache.geronimo.gbuild.agent.ClientManager</role>
        </requirement>
      </requirements>
      <configuration>
        <build-task-queue>BUILD.TASKS</build-task-queue>
        <tasks-directory>tasks</tasks-directory>
        <poll-interval>30</poll-interval>
      </configuration>
    </component>

    <!--
    | Build Results
    -->
    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildAgent</role>
      <role-hint>build-results</role-hint>
      <implementation>org.apache.geronimo.gbuild.agent.BuildResultsContinuumAgent</implementation>
      <requirements>
        <requirement>
          <role>org.apache.geronimo.gbuild.agent.BuildResultsExtensionManager</role>
        </requirement>
      </requirements>
      <configuration>
        <build-results-topic>BUILD.RESULTS</build-results-topic>
      </configuration>
    </component>

    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildResultsExtensionManager</role>
      <implementation>org.apache.geronimo.gbuild.agent.DefaultBuildResultsExtensionManager</implementation>
      <requirements>
        <requirement>
          <role>org.apache.geronimo.gbuild.agent.BuildResultsExtension</role>
          <field-name>extentions</field-name>
        </requirement>
      </requirements>
    </component>

    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildResultsExtension</role>
      <role-hint>write-include-file</role-hint>
      <implementation>org.apache.geronimo.gbuild.agent.WriteIncludeFileExtension</implementation>
      <configuration>
        <include-pattern>^include.*</include-pattern>
        <results-directory>results</results-directory>
        <date-format>yyyy-MM</date-format>
        <file-name-template>{date}/{project.name}/{project.version}/{build.name}-{build.id}.properties</file-name-template>
      </configuration>
    </component>


    <!--
    | Ping monitor
    -->
    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildAgent</role>
      <role-hint>ping-monitor</role-hint>
      <implementation>org.apache.geronimo.gbuild.agent.PingMonitorAgent</implementation>
      <requirements>
        <requirement>
          <role>org.apache.geronimo.gbuild.agent.ClientManager</role>
        </requirement>
      </requirements>
    </component>

    <!--
    | Build Activity
    -->
    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildAgent</role>
      <role-hint>build-activity</role-hint>
      <implementation>org.apache.geronimo.gbuild.agent.BuildActivityMonitor</implementation>
      <requirements>
        <requirement>
          <role>org.apache.geronimo.gbuild.agent.ClientManager</role>
        </requirement>
      </requirements>
      <configuration>
        <log-format>[{host-name}:{host-address}] {project.name}-{project.version} - {build.name} {build.id} - {notification}</log-format>
        <build-activity-topic>BUILD.ACTIVITY</build-activity-topic>
      </configuration>
    </component>

    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildActivityNotifier</role>
      <role-hint>ping-monitor</role-hint>
      <implementation>org.apache.geronimo.gbuild.agent.BuildActivityNotifier</implementation>
      <requirements>
        <requirement>
          <role>org.apache.geronimo.gbuild.agent.ClientManager</role>
        </requirement>
      </requirements>
      <configuration>
        <build-activity-topic>BUILD.ACTIVITY</build-activity-topic>
      </configuration>
    </component>

    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildAgentExtension</role>
      <role-hint>report-activity</role-hint>
      <implementation>org.apache.geronimo.gbuild.agent.ReportActivityExtension</implementation>
      <requirements>
        <requirement>
          <role>org.apache.maven.continuum.store.ContinuumStore</role>
        </requirement>
        <requirement>
          <role>org.apache.geronimo.gbuild.agent.BuildActivityNotifier</role>
        </requirement>
      </requirements>
    </component>

    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildAgentExtension</role>
      <role-hint>clean-dead-processes</role-hint>
      <implementation>org.apache.geronimo.gbuild.agent.KillProcessesExtension</implementation>
      <requirements>
        <requirement>
          <role>org.apache.geronimo.gbuild.agent.BuildActivityNotifier</role>
        </requirement>
      </requirements>
      <configuration>
        <regex>.*geronimo-tck.*</regex>
      </configuration>
    </component>

    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildAgentExtension</role>
      <role-hint>build-output</role-hint>
      <implementation>org.apache.geronimo.gbuild.agent.BuildOutputExtension</implementation>
      <requirements>
        <requirement>
          <role>org.apache.maven.continuum.configuration.ConfigurationService</role>
        </requirement>
        <requirement>
          <role>org.apache.maven.continuum.store.ContinuumStore</role>
        </requirement>
      </requirements>
      <configuration>
      </configuration>
    </component>

    <component>
      <role>org.apache.geronimo.gbuild.agent.BuildResultsExtension</role>
      <role-hint>log-failed-build-file</role-hint>
      <implementation>org.apache.geronimo.gbuild.agent.LogFailedBuildsExtension</implementation>
      <configuration>
        <results-directory>${plexus.home}/failed</results-directory>
        <date-format>yyyy-MM-dd-HHmm</date-format>
        <file-name-template>{project.name}-{project.version}/{date}-{host-name}-{build.name}-{build.id}.txt</file-name-template>
      </configuration>
    </component>

  </components>
</component-set>
