## 1 = new
## 2 = ok
## 3 = failed
## 4 = error
## 5 = signalled
## 6 = building
## 7 = checking out
## 8 = updating

$page.setTitle( "Continuum" )

#set( $success = 0 )
#set( $failures = 0 )
#set( $errors = 0 )

<div class="app">
  <div id="h3">
    <h3>Continuum Projects</h3>
    <table border="1" cellspacing="2" cellpadding="3" width="100%" id="projectSummaryTable">

      <!-- i18n -->
      <tr>
        <th>Status</th>
        <th>Name</th>
        <th>Version</th>
        <th>Build</th>
        <th colspan="7"></th>
      </tr>

      #set ( $items = $continuum.projects )

      #foreach ( $item in $items )
      #if ( $item.state == 2 )
        #set( $success = $success + 1 )
      #elseif ( $item.state == 3 )
        #set( $failures = $failures + 1 )
      #elseif( $item.state == 4 )
        #set( $errors = $errors + 1 )
      #end

      <tr class="$css.nextClass">
        <td>$state.generate( $item )</td>
        <td>$!item.name</td>
        <td>$!item.version</td>
        <td>$item.buildNumber</td>
        <td><a href="$link.setPage('View.vm').addPathInfo('fid', "$!{item.executorId}Project").addPathInfo('id', $item.id)">View</a></td>

        ## Operations

        <td><a href="$link.setPage('Edit.vm').addPathInfo('fid', "$!{item.executorId}Project").addPathInfo('id', $item.id)">Edit</a></td>

        #if ( $item.state == 1 || $item.state == 2 || $item.state == 3 || $item.state == 4 )
        <td><a href="$link.setPage('Delete.vm').addPathInfo('fid', "$!{item.executorId}Project").addPathInfo('id', $item.id)">Delete</a></td>
        #else
        <td>Delete</td>
        #end

        #if ( $item.latestBuildId )
        ## TODO: get rid of this call back to $continuum
        #set ( $build = $continuum.getLatestBuildResultForProject($item.id) )
        <td><a href="$link.setPage('ProjectBuild.vm').addPathInfo('view', "ProjectBuild").addPathInfo('id', $item.id).addPathInfo('buildId', $build.id)">Last Result</a></td>
        #else
        <td>Last Result</td>
        #end

        #if ( $item.latestBuildId )
        <td><a href="$link.setPage('ProjectBuilds.vm').addPathInfo('view', "ProjectBuilds").addPathInfo('id', $item.id)">All Results</a></td>
        #else
        <td>All Results</td>
        #end

        #if ( $item.state == 1 || $item.state == 2 || $item.state == 3 || $item.state == 4 )
        <td><a href="$link.addPathInfo('action', 'cam').addPathInfo('cid','buildProject').addPathInfo('id', $item.id)">Build</a></td>
        #else
        <td>Build</td>
        #end

        <td><a href="$link.setPage('ProjectNotifiers.vm').addPathInfo('view', "ProjectNotifiers").addPathInfo('id', $item.id )">Notifiers</a></td>

      </tr>
      #end
    </table>

    <div class="functnbar3">
      <form method="post" action="$link">
        #if ( $items && $items.size() > 0 )
        #hidden ( "action" "cam" )
        #hidden ( "cid" "buildAllProjects" )
        <input type="submit" name="build-all" value="Build All"/>
        #end
      </form>
    </div>
  </div>
</div>

<table>
  <tr>
    <td align="right">
      <img src="/continuum/images/icon_success_sml.gif" alt="Success"/> $success
      <img src="/continuum/images/icon_error_sml.gif" alt="Failed"/> $failures
      <img src="/continuum/images/icon_warning_sml.gif" alt="Error"/> $errors
    </td>
  </tr>
</table>